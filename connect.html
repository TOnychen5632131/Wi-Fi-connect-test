<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="6a97888e-site-verification" content="6154acbc37ea52e552933b0da32eaa09">
    <!-- Client Hints Meta Tag -->
    <meta http-equiv="Delegate-CH"
        content="Sec-CH-UA https://s.magsrv.com; Sec-CH-UA-Mobile https://s.magsrv.com; Sec-CH-UA-Arch https://s.magsrv.com; Sec-CH-UA-Model https://s.magsrv.com; Sec-CH-UA-Platform https://s.magsrv.com; Sec-CH-UA-Platform-Version https://s.magsrv.com; Sec-CH-UA-Bitness https://s.magsrv.com; Sec-CH-UA-Full-Version-List https://s.magsrv.com; Sec-CH-UA-Full-Version https://s.magsrv.com;">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wi-Fi Access</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="icon"
        href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3E%3Crect width='16' height='16' fill='%23ffffff'/%3E%3Ccircle cx='8' cy='8' r='5' fill='%230ea5a4'/%3E%3C/svg%3E">

    <!-- Fluid Player SDK -->
    <script src="https://cdn.fluidplayer.com/v3/current/fluidplayer.min.js"></script>

    <style>
        :root {
            color-scheme: light;
            --ink: #0f172a;
            --muted: #475569;
            --accent: #0ea5a4;
            --accent-strong: #0f766e;
            --accent-glow: rgba(14, 165, 164, 0.25);
            --card: #ffffff;
            --border: rgba(15, 23, 42, 0.08);
            --shadow: 0 24px 60px rgba(15, 23, 42, 0.12);
        }

        html,
        body {
            height: 100%;
        }

        body {
            background:
                radial-gradient(1200px 600px at 10% 0%, rgba(14, 165, 164, 0.18), transparent 60%),
                radial-gradient(900px 600px at 100% 10%, rgba(251, 191, 36, 0.22), transparent 55%),
                linear-gradient(180deg, #f8fafc 0%, #eef2f7 100%);
            color: var(--ink);
            font-family: "Space Grotesk", "Work Sans", sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            height: 100%;
            margin: 0;
            text-align: center;
            padding: 24px;
        }

        body.ad-active {
            overflow: hidden;
        }

        .container {
            background: var(--card);
            padding: 32px 28px;
            border-radius: 24px;
            box-shadow: var(--shadow);
            max-width: 420px;
            width: 100%;
            border: 1px solid var(--border);
            animation: floatIn 0.6s ease both;
        }

        h2 {
            margin: 0 0 16px;
            color: var(--ink);
            font-size: clamp(1.6rem, 2.3vw, 2.1rem);
            letter-spacing: -0.02em;
        }

        p {
            color: var(--muted);
            margin: 0 0 18px;
            line-height: 1.5;
        }

        .primary-btn {
            appearance: none;
            border: none;
            background: linear-gradient(135deg, var(--accent), #22c55e);
            color: #ffffff;
            padding: 14px 28px;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 999px;
            cursor: pointer;
            box-shadow: 0 14px 30px rgba(14, 165, 164, 0.32);
            transition: transform 0.2s ease, box-shadow 0.2s ease, filter 0.2s ease;
        }

        .primary-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 18px 36px rgba(14, 165, 164, 0.35);
            filter: brightness(1.02);
        }

        .primary-btn:active {
            transform: translateY(1px);
        }

        /* Loading Animation */
        .loader {
            border: 5px solid rgba(14, 165, 164, 0.2);
            border-top: 5px solid var(--accent);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        #video-section {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 50;
            background: #e2e8f0;
        }

        #video-section.is-visible {
            display: block;
        }

        .video-wrap {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            background-color: #1e293b;
        }

        #ad-video {
            width: 100%;
            height: 100%;
            position: absolute;
            inset: 0;
            background: #1e293b;
            object-fit: cover;
        }

        .fluid_video_wrapper {
            width: 100% !important;
            height: 100% !important;
        }

        .ad-overlay {
            position: absolute;
            inset: 0;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 16px;
            pointer-events: none;
        }

        #status-text {
            margin: 0;
            padding: 8px 12px;
            background: rgba(15, 23, 42, 0.65);
            color: #f8fafc;
            border-radius: 999px;
            font-size: 0.9rem;
            font-weight: 600;
            letter-spacing: 0.01em;
            backdrop-filter: blur(6px);
            pointer-events: auto;
            align-self: flex-start;
            margin-top: 60px;
            /* Push down below the close button area if needed, or keep it. */
            /* Actually, user said button put here is fine. Let's make status text sit in the same spot but let button cover it when active, or move status text slightly. 
               Let's move status text to the center top instead to avoid conflict. */
            align-self: center;
            top: 16px;
            position: absolute;
        }

        #close-ad-btn {
            appearance: none;
            border: none;
            border-radius: 999px;
            padding: 12px 18px;
            font-size: 0.95rem;
            font-weight: 600;
            background: rgba(255, 255, 255, 0.96);
            color: #0f172a;
            box-shadow: 0 16px 30px rgba(15, 23, 42, 0.25);
            cursor: pointer;
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.25s ease, transform 0.25s ease;
            pointer-events: none;
            align-self: flex-start;
            position: absolute;
            top: 16px;
            left: 16px;
            z-index: 60;
            margin: 0;
        }

        #close-ad-btn:focus-visible {
            outline: 2px solid rgba(14, 165, 164, 0.6);
            outline-offset: 2px;
        }

        #video-section.ready-to-close #close-ad-btn {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }

        #wifi-section {
            display: none;
            animation: fadeIn 1s;
        }

        .qr-image {
            width: 100%;
            max-width: 250px;
            border-radius: 10px;
            border: 4px solid rgba(14, 165, 164, 0.35);
            margin-bottom: 10px;
            -webkit-touch-callout: default;
            pointer-events: auto;
            transform: scale(1);
            transform-origin: center;
            animation: qrPulse 1.6s ease-in-out infinite;
            box-shadow: 0 12px 28px rgba(14, 165, 164, 0.2);
        }

        .hint {
            font-size: 14px;
            color: var(--muted);
            margin-top: 10px;
            background: #f1f5f9;
            padding: 12px;
            border-radius: 12px;
            border: 1px solid rgba(15, 23, 42, 0.08);
        }

        .ssid-line {
            font-size: 0.75rem;
            margin-top: 16px;
            color: var(--muted);
            letter-spacing: 0.02em;
        }

        @keyframes qrPulse {

            0%,
            100% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(14, 165, 164, 0);
            }

            50% {
                transform: scale(1.06);
                box-shadow: 0 0 0 14px rgba(14, 165, 164, 0.2);
            }
        }

        @keyframes floatIn {
            from {
                opacity: 0;
                transform: translateY(14px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }
    </style>
</head>

<body>

    <div class="container">

        <!-- 1. Start Screen -->
        <div id="start-section">
            <h2>Free Wi-Fi Access</h2>
            <p>Watch a short ad to unlock the password.</p>
            <button id="start-btn" class="primary-btn" type="button">Start 15-second Ad</button>
        </div>

        <!-- 3. WiFi QR Code Screen -->
        <div id="wifi-section">
            <h2>Wi-Fi password unlocked</h2>
            <p>Please connect now.</p>
            <p>Long press the QR code below to join</p>

            <img src="https://api.qrserver.com/v1/create-qr-code/?data=WIFI:S:awesome%20speed;T:WPA;P:arjunreddy;;&size=400x400"
                alt="WiFi QR Code" class="qr-image">

            <div class="hint">
                Tip: <strong>Long press</strong> the QR code, then tap "Join Network"<br>
                or use "Google Lens"
            </div>

            <p class="ssid-line">SSID: awesome speed | PW: arjunreddy</p>
        </div>

    </div>

    <!-- 2. Video Player for VAST Ad -->
    <div id="video-section" aria-hidden="true">
        <div class="video-wrap">
            <video id="ad-video" playsinline webkit-playsinline
                poster="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 360'%3E%3Crect width='640' height='360' fill='%231e293b'/%3E%3Ctext x='50%25' y='50%25' fill='%23e2e8f0' font-size='28' text-anchor='middle' dominant-baseline='middle'%3ELoading%20Ad...%3C/text%3E%3C/svg%3E">
                <source src="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4"
                    type="video/mp4" />
            </video>
        </div>
        <div class="ad-overlay">
            <p id="status-text" aria-live="polite">Loading ad...</p>
            <button id="close-ad-btn" type="button" aria-disabled="true" disabled>Close ad &amp; connect Wi-Fi</button>
        </div>
    </div>

    <!-- Script to Handle Flow -->
    <script>
        const startSection = document.getElementById('start-section');
        const videoSection = document.getElementById('video-section');
        const wifiSection = document.getElementById('wifi-section');
        const startBtn = document.getElementById('start-btn');
        const statusText = document.getElementById('status-text');
        const closeAdBtn = document.getElementById('close-ad-btn');
        const adVideo = document.getElementById('ad-video');

        let fluidPlayerInstance = null;
        const AD_SECONDS = 15;
        let timeLeft = AD_SECONDS;
        let fallbackTimer = null;

        function setStatus(message) {
            if (statusText) {
                statusText.textContent = message;
            }
        }

        function clearFallbackTimer() {
            if (fallbackTimer) {
                clearTimeout(fallbackTimer);
                fallbackTimer = null;
            }
        }

        function playFallbackVideo(reason) {
            if (!adVideo) {
                return;
            }
            if (reason) {
                setStatus(reason);
            }
            adVideo.muted = true;
            adVideo.controls = false;
            const playPromise = adVideo.play();
            if (playPromise && typeof playPromise.catch === 'function') {
                playPromise.catch(() => { });
            }
        }

        function scheduleFallbackPlayback() {
            clearFallbackTimer();
            fallbackTimer = setTimeout(() => {
                if (!adVideo) {
                    setStatus('Ad failed to load.');
                    return;
                }
                const noPlayback = adVideo.readyState === 0 || adVideo.paused || adVideo.currentTime === 0;
                if (noPlayback) {
                    playFallbackVideo('Ad failed to load. Playing fallback video...');
                }
            }, 3000);
        }

        function bindPlayerEvents(instance) {
            if (!instance || typeof instance.on !== 'function') {
                return;
            }
            instance.on('vast.error', () => {
                playFallbackVideo('Ad failed to load. Playing fallback video...');
            });
            instance.on('vast.noad', () => {
                playFallbackVideo('No ad available. Playing fallback video...');
            });
        }

        // Initialize Fluid Player
        function initPlayer() {
            if (typeof fluidPlayer !== 'function') {
                playFallbackVideo('Ad player failed to load. Playing fallback video...');
                return;
            }
            try {
                fluidPlayerInstance = fluidPlayer('ad-video', {
                    layoutControls: {
                        primaryColor: "#0ea5a4",
                        playButtonShowing: false, // Hide play button to force ad view
                        fillToContainer: true,
                        autoPlay: true,
                        mute: false,
                        doubleclickFullscreen: false
                    },
                    vastOptions: {
                        allowVastTagLegacy: true,
                        adList: [
                            {
                                roll: 'preRoll',
                                vastTag: 'https://s.magsrv.com/v1/vast.php?idzone=5814390'
                            }
                        ],
                        adCTAText: false
                    }
                });
                bindPlayerEvents(fluidPlayerInstance);
            } catch (e) {
                console.log("Fluid Player Init Error:", e);
                playFallbackVideo('Ad player failed to load. Playing fallback video...');
            }
        }

        if (adVideo) {
            adVideo.addEventListener('playing', () => {
                clearFallbackTimer();
            });
            adVideo.addEventListener('error', () => {
                setStatus('Video failed to load.');
            });
        }

        if (closeAdBtn) {
            closeAdBtn.addEventListener('click', () => {
                if (videoSection.classList.contains('ready-to-close')) {
                    finishAd();
                }
            });
        }

        // Handle User Click
        startBtn.addEventListener('click', function () {
            startSection.style.display = 'none';
            videoSection.classList.add('is-visible');
            videoSection.classList.remove('ready-to-close');
            videoSection.setAttribute('aria-hidden', 'false');
            document.body.classList.add('ad-active');
            timeLeft = AD_SECONDS;
            setStatus(`Ad ends in ${timeLeft}s`);
            if (closeAdBtn) {
                closeAdBtn.disabled = true;
                closeAdBtn.setAttribute('aria-disabled', 'true');
            }

            // 1. Initialize the Player
            initPlayer();
            scheduleFallbackPlayback();

            // 2. Start the 15-second global timer immediately
            const timerInterval = setInterval(() => {
                timeLeft--;
                if (timeLeft > 0) {
                    setStatus(`Ad ends in ${timeLeft}s`);
                    return;
                }
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    setStatus('Ad finished. You can close to connect Wi-Fi.');
                    videoSection.classList.add('ready-to-close');
                    if (closeAdBtn) {
                        closeAdBtn.disabled = false;
                        closeAdBtn.removeAttribute('aria-disabled');
                    }
                }
            }, 1000);
        });

        function finishAd() {
            // Try to stop/destroy player
            try {
                if (fluidPlayerInstance) {
                    // fluidPlayer doesn't always have a clean destroy, so we just hide it
                    // calling destroy() if available
                }
            } catch (e) { }

            clearFallbackTimer();
            if (adVideo) {
                adVideo.pause();
                adVideo.currentTime = 0;
            }

            videoSection.classList.remove('is-visible', 'ready-to-close');
            videoSection.setAttribute('aria-hidden', 'true');
            wifiSection.style.display = 'block';
            document.body.classList.remove('ad-active');
        }
    </script>
</body>

</html>